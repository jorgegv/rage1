################################################################################
##
## RAGE1 - Retro Adventure Game Engine, release 1
## (c) Copyright 2020 Jorge Gonzalez Villalonga <jorgegv@daikon.es>
## 
## This code is ublished under a GNU GPL license version 3 or later.  See
## LICENSE file in the distribution for details.
## 
################################################################################

.SILENT:

MYMAKE			= $(MAKE) -s -f Makefile-48
ZPRAGMA_INC		= zpragma-48.inc

# All taps
TAPS			= $(BAS_LOADER_TAP) $(LOADING_SCREEN_TAP) $(MAIN_TAP)

-include Makefile.common

.PHONY: taps

# add SRC and OBJS for 48K build
SRC			+= $(BANKED_CODE_SRC_COMMON)
OBJS			+= $(BANKED_CODE_OBJS_COMMON)

build:
	cp $(ENGINE_DIR)/loader48/$(LOADER48) $(BAS_LOADER)
	$(MYMAKE) -j8 main
	$(MYMAKE) -j8 taps
	$(MYMAKE) final
	$(MYMAKE) section-check

## Taps

taps: $(TAPS)

# we set org at 0x5F00 for 48 mode
$(MAIN_TAP): $(MAIN_BIN)
	echo "Creating TAP $@..."
	z88dk-appmake +zx --noloader --org 0x5F00 -b $<

$(MAIN_BIN): $(OBJS)
	echo "Bulding $(MAIN_BIN)...."
	$(ZCC) $(ZCC_TARGET) $(CFLAGS) $(CFLAGS_LIST) $(INCLUDE) $(LIBDIR) $(LIBS) $(OBJS) -startup=31 -o $(MAIN_BIN)

## Run options

FUSE_RUN_OPTS		= --machine 48
