# MAP: SCREEN_DATA DESIGN

Syntax:

- There must be 24 lines of 64 characters each.  This covers the 32x24 ZX
  Spectrum screen with character cells.  Each cell is represented with 2
  chars (a digraph) to make it somewhat square.  Check: there are 24 lines
  of 64 chars each.

- The digraphs used in the SCREEN_DATA lines must be defined with DEFINE
  directives.  These directives map the digraphs to the BTILEs they
  represent.

- The objective is to compile the 32x24 cell screen to a list of btiles with
  their names, types and positions on screen.

- This list can be added to the 'btiles' list for the screen, to be
  processed later.

Procedure:

- An initial DEST array of 32x24 is generated (all digraphs set to '  ' - 2
  spaces)

- A DATA array of 32x24 is populated with the digraphs in each position
  taken from the SCREEN_DATA lines (split the SCREEN_DATA lines in groups of
  2 chars)

- The DATA array is processed cell by cell, left to right, top to bottom.
    - If a cell in DATA contains a non-null graph (i.e. not '  '), then:
      - If the same cell in DEST contains a null graph, then:
        - Lookup the associated BTILE and its dimensions and die if there is no defined digraph
        - "Paint" the BTILE in the DEST array by setting the graphs to those of
          the btile in all the cells (we know everything: position, width,
          height)
        - Add the found BTILE to the new-btiles list with the current position, type
          and btile information. Possibly generate a name for it.
      - If the same cell in DEST contains a non-null graph and it's different, then:
        - Exit with error, since this means that some btiles are overlapping
          (should we allow overlapping btiles?)

- When this processing is finished, we have:
  - A list of btiles with names, types and positions
  - Generated DEST array with the compiled data (the data lines that would
    be generated by the previous list)
  - Original DATA array with input data

- If we have compiled everything OK and the syntax is correct, the arrays
  DATA and DEST must be the same, element by element.  Check: run over the 2
  arrays and check equality of each element.

- If everything is OK, we can add the btile list to the global btile list
  for the screen and continue normally.
